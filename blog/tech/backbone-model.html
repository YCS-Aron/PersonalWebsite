<div class="blog-body">
    <header class="header">
        <div class="title">
            <h1>Backbone的Model</h1>
            <p class="subline">对Backbone的组件之一Model的特性和使用方法的介绍</p>
            <p class="blog-time"><strong>姚川松</strong> &#8212; 写于 <strong>2015/7/1</strong></p>
        </div>
    </header>
    <article class="article-content">
        <div>
            <p>Model作为Backbone中数据存储的组件, 为开发者提供了丰富的数据相关的特性, 以满足实际开发中的需求. View, Collection, Controller等组件都依赖于Model中的数据, View中定义的页面元素需要数据的支撑, Collection是Model的集合, 用以保存批量数据. Controller中定义逻辑操作, 而操作的对象就包括了Model中的数据. 因此Model作为Backbone的基础组件, 为Backbone提供了数据上的支持. 而往往基础的才是最重要的.</p>
            <p>Model组件为我们提供了很多特性, 包括数据监听, 数据验证, 数据回滚, 将数据与服务器同步 . 其中监听和与服务器的同步是从Events和Syn组件中继承来的.</p>
            <h2>数据监听</h2>
            <p>从最早版本的Backbone就提供了数据监听的功能, 用以实现实时更新数据相关的其他数据或者界面元素. 数据监听是通过change事件的监听来实现的. 早起版本的Backbone的Events提供了on, off, trigger, once等方法来实现事件监听. 后来又添加了更强大的listenTo等方法 .虽然同是事件监听功能, 却满足不同的需求. 下面是一个例子:</p>
            <pre><code class="javascript">
var people = Backbone.Model.extent({
    default: {
        name: 'Aron',
        age: 24
    }
});
var me = new people();
me.on('change:name', changeName);
var changeName = function(model, value){
    console.log('My name changed to ' + value);
}
me.set('name', 'ycs');          //output: My name changed to ycs
me.trigger('change:name');      //output: My name changed undefined
me.off('change:name');          //删除对name的change事件的监听
me.set('name', 'yaochuansong'); //output nothing
            </code></pre>
            <div class="warning">
                <span>Model上的数据都是保存在attributes属性上的, 如果你直接操作attributes上的数据, 不会触发任何change事件.</span>
            </div>
            <h2>数据验证</h2>
            <p>当设置Model的属性和保存数据到服务器时, 对数据进行验证是很有必要的. 因此Model提供了Validate方法用来实现数据验证功能. 它的参数是新设置的值的JSON对象, 如果验证失败, 则返回出错信息, 否则, 不返回任何数据. 下面是一个例子:</p>
<pre><code class="javascript">
var people = Backbone.Model.extent({
    default: {
        name: 'Aron',
        age: 24
    },
    validate: function(attrs){
        if(attrs.age < 0) {
            return 'value of age must be positive';
        }
    }
});
var me = new people();
me.set('age', -1);          //output: value of age must be positive
</code></pre>
            <h2>数据回滚</h2>
            <p>Model为错误提供了一个挽回方法, Model会保存最近一次数据更改前的Model中attributes属性的状态, 通过保存attributes的拷贝为Model的一个属性, 名为previousAttributes, 或者通过Model的previous方法返回指定属性的旧值, 用以恢复到之前的状态.</p>
<pre><code class="javascript">
var people = Backbone.Model.extent({
    default: {
        name: 'Aron',
        age: 24
    }
});
var me = new people();
me.set('name', 'ycs');
console.log(me.get('name'));    //output: ycs
me.set('name', me.previous('name'));
console.log(me.get('name'));    //output: Aron
</code></pre>
            <h2>将数据与服务器同步</h2>
            <p>Backbone中与服务器的通信是通过Syn组件完成的, 而会继承Syn中方法的组件只有Model和Collection, 因为只有这两个组件是和数据相关的. Model通过save, fetch, destroy方法来保存数据到服务器, 从服务器获取数据和删除数据. 底层都是采用了jQuery的ajax实现.</p>
            <p>既然是涉及到与服务器的交互, 就必然涉及到发送请求的方式, 即是采用GET, 还是PUT, 还是POST方法. 而且需要对数据进行识别, 就必然需要设置识别码来让服务器服务器知道获取什么样的数据. Model有一个属性id, 可以用来唯一标示Model, 可以把id属性想象成书的ISBN. 这是Backbone设计的通过id属性来标示Model的方法, 那么后端也必然需要针对Model的这一特性设计API和返回的数据内容. 而且, 我们还需要URL来发送请求, 这些都可以在Model中设置. 下面是一个例子:</p>
            <p></p>
<pre><code class="javascript">
var people = Backbone.Model.extent({
    url: 'backend/'
    id: 'identityCardNo'
    default: {
        name: 'Aron',
        age: 24,
        identityCardNo: '123123'
    }
});
var me = new people();
me.fetch();     //GET backend/
me.set('name', 'ycs');
me.save();      //POST或者是PUT backend/
me.destroy();   //DELETE backend/
</code></pre>
            <div class="warning">
                <span>一般来说, Model中的属性都对应这数据库中表的一个字段, 所以不要随便为Model的attributes对象添加不必要的属性, 否则在save时会报错.</span>
            </div>
            <div class="warning">
                <span>Model有一个isNew方法, 用来检查该Model是不是新建的, 如果是新建的, 则调用save方法时采用POST方法发送请求, 否则, 采用PUT方法.</span>
            </div>
            <div class="warning">
                <span>Model的save, fetch, destroy只是定义了这样的一个接口, 后台具体如何实现不受任何限制.</span>
            </div>
            <!--<p><strong>Excerpt from: <a href="http://www.gutenberg.org/ebooks/15237">The Chemistry of Food and Nutrition</a> by A. W. Duncan</strong></p>-->
        </div>
    </article>
</div> <!-- blog-body -->